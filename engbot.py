import os
from dotenv import load_dotenv

import telebot

from telebot import types

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ .env

load_dotenv()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ Telegram-–±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞

bot = telebot.TeleBot(TOKEN)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start

@bot.message_handler(commands=['start'])

def start(message):

    # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

    markup = types.InlineKeyboardMarkup()

    markup.add(types.InlineKeyboardButton('–°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–æ–º', url='https://t.me/milwgiv'))

    markup.add(types.InlineKeyboardButton('–î—Ä—É–≥–∏–µ –º–∞—Ä–∞—Ñ–æ–Ω—ã Way Giver', url='https://t.me/addlist/qLaq0UdnBh80NDky'))

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π

    bot.reply_to(

        message,

        f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, {message.from_user.first_name}!\n –í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É –æ—Ç way giver! üéØ\n\n"

        "–ë–æ—Ç Way Giver –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –í–∞—à —É—Ä–æ–≤–µ–Ω—å –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —Ç–µ–±—è. "

        "–Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –º–∞—Ä–∞—Ñ–æ–Ω –ø–æ–º–æ–∂–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ–±–µ, –Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞–π, —á—Ç–æ –º–Ω–æ–≥–æ–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ –∂–µ–ª–∞–Ω–∏—è –∏ —É–ø–æ—Ä—Å—Ç–≤–∞!\n\n"

        "–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /level \n\n"

        "–ù–µ –∑–∞–±—É–¥—å—Ç–µ, —á—Ç–æ —É –í–∞—Å –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞ –∑–≤—ë–∑–¥—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü",

        reply_markup=markup

    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ /level, /strong, /weak (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —Å–æ–∑–¥–∞—é—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è)

# ...

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /task (–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤)

@bot.message_handler(commands=['task'])

def start(message):

    bot.reply_to(

        message,

        f"{message.from_user.first_name}, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–æ–π "

        "–≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:\n\n A1, —Ä–∞–∑–≥–æ–≤–æ—Ä, —á—Ç–µ–Ω–∏–µ (–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, –≤—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç, —Ç—Ä–µ—Ç–∏–π)\n\n"

        "–í—Å—ë –Ω–∞–ø–∏—Å–∞–Ω–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é —Å –ø—Ä–æ–±–µ–ª–æ–º. –£—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è —è–∑—ã–∫–æ–º –Ω–∞–ø–∏—Å–∞–Ω —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã, "

        "–∞ —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã - —Å –º–∞–ª–µ–Ω—å–∫–æ–π."

    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /manual

@bot.message_handler(commands=['manual'])

def start(message):

    markup = types.InlineKeyboardMarkup()

    markup.add(types.InlineKeyboardButton('–ü–æ–ª—É—á–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –æ–±—É—á–µ–Ω–∏–µ', url='https://t.me/+cb8Jz1KpO0dhNWFi'))

    bot.reply_to(

        message,

        f"{message.from_user.first_name}, –í—ã —É–∑–Ω–∞–ª–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –±–æ—Ç–∞ Way Giver!\n"

        "–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª —Å–≤–µ—Ä—å—Ç–µ –≤—ã—à–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ\n\n"

        "–ù–µ –∑–∞–±—É–¥—å—Ç–µ, —á—Ç–æ –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ (–Ω–∞ –∫–∞–Ω–∞–ª —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º) –∑–∞ –∑–≤—ë–∑–¥—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü",

        reply_markup=markup

    )

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –∏ –Ω–∞–≤—ã–∫–æ–≤

levels = ["–ê1", "–ê2", "–í1", "–í2", "–°1", "–°2"]

skills = ["—á—Ç–µ–Ω–∏–µ", "—Ä–∞–∑–≥–æ–≤–æ—Ä", "–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞"]

skills_numbers = {

    "—á—Ç–µ–Ω–∏–µ": "1",

    "—Ä–∞–∑–≥–æ–≤–æ—Ä": "2",

    "–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞": "3"

}

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∞–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω—è –∏ –Ω–∞–≤—ã–∫–æ–≤)

@bot.message_handler(func=lambda message: not message.text.startswith('/'))

def handle_message(message):

    text = message.text.lower().strip()

    parts = [x.strip() for x in text.split(",")]

    if len(parts) >= 2:

        user_level = parts[0].upper()

        input_skills = parts[1:]

        if user_level not in levels:

            bot.reply_to(message, "–ù–µ–≤–µ—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑: –ê1, –ê2, –í1, –í2, –°1, –°2")

            return

        for sk in input_skills:

            if sk not in skills:

                bot.reply_to(message, f"–ù–∞–≤—ã–∫ '{sk}' –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã: —á—Ç–µ–Ω–∏–µ, —Ä–∞–∑–≥–æ–≤–æ—Ä, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞")

                return

        missing_skills = [sk for sk in skills if sk not in input_skills]

        full_skills = input_skills + missing_skills

        numbers = [skills_numbers[sk] for sk in full_skills]

        code = f"{user_level}-{'-'.join(numbers)}"

        bot.reply_to(message,

                     f"–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {code}\n"

                     "–í—ã —É–∑–Ω–∞–ª–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –±–æ—Ç–∞ Way Giver!\n\n"

                     "–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /manual"

                     )

    else:

        bot.reply_to(message,

                     "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"

                     "–ê1(—Ä—É—Å—Å–∫–∞—è –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞), —á—Ç–µ–Ω–∏–µ, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ (—Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é —Å –ø—Ä–æ–±–µ–ª–æ–º –∏ —Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã)"

                     )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ç–æ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –±–æ—Ç –Ω–µ —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ñ–æ—Ç–æ)

@bot.message_handler(content_types=['photo'])

def get_photo(message):

    bot.reply_to(message, '–ë–æ—Ç Way Giver English –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ñ–æ—Ç–æ')

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

bot.polling(none_stop=True)

